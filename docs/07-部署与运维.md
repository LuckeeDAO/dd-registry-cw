# DD Registry CW éƒ¨ç½²ä¸è¿ç»´æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**: DD Registry CW (æ¨èç§¯åˆ†åˆçº¦)
- **ç‰ˆæœ¬**: v1.0
- **æ–‡æ¡£ç±»å‹**: éƒ¨ç½²ä¸è¿ç»´ç±»æ–‡æ¡£
- **åˆ›å»ºæ—¥æœŸ**: 2024-01-XX
- **æœ€åæ›´æ–°**: 2024-01-XX

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£ç”±AIæ ¹æ®æ•´ä¸ªé¡¹ç›®ä¸Šä¸‹æ–‡è‡ªåŠ¨ç”Ÿæˆï¼ŒåŒ…å«ç²¾ç¡®çš„éƒ¨ç½²æµç¨‹ã€ç¯å¢ƒé…ç½®ã€ç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦è§„åˆ™ã€‚ç¡®ä¿äº¤ä»˜ç‰©èƒ½è¢«æ­£ç¡®ã€é«˜æ•ˆåœ°éƒ¨ç½²å’Œè¿ç»´ã€‚

## ğŸš€ éƒ¨ç½²æ¸…å•ä¸æµç¨‹

### 1. éƒ¨ç½²å‰å‡†å¤‡

#### 1.1 ç¯å¢ƒè¦æ±‚

```yaml
environment_requirements:
  hardware:
    minimum_cpu: "4 cores"
    minimum_memory: "8GB RAM"
    minimum_storage: "100GB SSD"
    recommended_cpu: "8 cores"
    recommended_memory: "16GB RAM"
    recommended_storage: "500GB SSD"
  
  software:
    operating_system: "Ubuntu 20.04 LTS or later"
    rust_version: ">= 1.70.0"
    cosmwasm_version: ">= 1.4.0"
    wasmd_version: ">= 0.45.0"
    cosmwasm_opt_version: ">= 0.16.0"
  
  network:
    internet_connection: "Stable broadband"
    firewall_rules: "Allow ports 26656, 26657, 1317"
    dns_resolution: "Required for external connections"
```

### 2. åˆçº¦æ„å»ºæµç¨‹

#### 2.1 DD Registry CW æ„å»º

```bash
#!/bin/bash
# DD Registry CW æ„å»ºè„šæœ¬ - build_dd_registry.sh

set -e

echo "å¼€å§‹æ„å»º DD Registry CW åˆçº¦..."

cd /home/lc/luckee_dao/dd-registry-cw

# æ¸…ç†ä¹‹å‰çš„æ„å»º
cargo clean

# æ„å»ºåˆçº¦
RUSTFLAGS='-C link-arg=-s' cargo build --release --target wasm32-unknown-unknown

# ä¼˜åŒ–åˆçº¦
cosmwasm-opt target/wasm32-unknown-unknown/release/dd_registry_cw.wasm \
  -o target/wasm32-unknown-unknown/release/dd_registry_cw_optimized.wasm

# éªŒè¯æ„å»ºç»“æœ
ls -la target/wasm32-unknown-unknown/release/dd_registry_cw_optimized.wasm

echo "DD Registry CW æ„å»ºå®Œæˆï¼"
echo "åˆçº¦å¤§å°: $(du -h target/wasm32-unknown-unknown/release/dd_registry_cw_optimized.wasm | cut -f1)"
```

### 3. éƒ¨ç½²æµç¨‹

#### 3.1 åˆçº¦ä¸Šä¼ 

```bash
#!/bin/bash
# åˆçº¦ä¸Šä¼ è„šæœ¬ - upload_dd_registry.sh

set -e

echo "å¼€å§‹ä¸Šä¼  DD Registry CW åˆçº¦..."

cd /home/lc/luckee_dao/deployment

# ä¸Šä¼  DD Registry CW åˆçº¦
echo "ä¸Šä¼  DD Registry CW åˆçº¦..."
DD_REGISTRY_CODE_ID=$(wasmd tx wasm store \
  ../dd-registry-cw/target/wasm32-unknown-unknown/release/dd_registry_cw_optimized.wasm \
  --from ${ADMIN_ADDRESS} \
  --chain-id ${CHAIN_ID} \
  --node ${NODE} \
  --gas auto \
  --gas-adjustment 1.3 \
  --yes \
  --output json | jq -r '.logs[0].events[0].attributes[0].value')

echo "DD Registry CW Code ID: ${DD_REGISTRY_CODE_ID}"
echo "DD_REGISTRY_CODE_ID=${DD_REGISTRY_CODE_ID}" >> contract_addresses.env

echo "DD Registry CW åˆçº¦ä¸Šä¼ å®Œæˆï¼"
```

#### 3.2 åˆçº¦å®ä¾‹åŒ–

```bash
#!/bin/bash
# åˆçº¦å®ä¾‹åŒ–è„šæœ¬ - instantiate_dd_registry.sh

set -e

echo "å¼€å§‹å®ä¾‹åŒ– DD Registry CW åˆçº¦..."

cd /home/lc/luckee_dao/deployment
source contract_addresses.env

# å®ä¾‹åŒ– DD Registry CW åˆçº¦
echo "å®ä¾‹åŒ– DD Registry CW åˆçº¦..."
DD_REGISTRY_CONTRACT=$(wasmd tx wasm instantiate ${DD_REGISTRY_CODE_ID} '{
  "admin": "'${ADMIN_ADDRESS}'",
  "config": {
    "enabled": true,
    "max_referral_depth": 3,
    "referral_cooldown": 3600,
    "max_daily_referrals": 10,
    "points_decay_period": 30,
    "points_decay_rate": "0.01",
    "min_withdrawal_amount": "1000",
    "emergency_paused": false
  }
}' \
  --from ${ADMIN_ADDRESS} \
  --chain-id ${CHAIN_ID} \
  --node ${NODE} \
  --label "DD Registry CW v1.0" \
  --gas auto \
  --gas-adjustment 1.3 \
  --yes \
  --output json | jq -r '.logs[0].events[0].attributes[0].value')

echo "DD Registry CW Contract Address: ${DD_REGISTRY_CONTRACT}"
echo "DD_REGISTRY_CONTRACT=${DD_REGISTRY_CONTRACT}" >> contract_addresses.env

echo "DD Registry CW åˆçº¦å®ä¾‹åŒ–å®Œæˆï¼"
```

### 4. éƒ¨ç½²éªŒè¯

#### 4.1 åˆçº¦çŠ¶æ€æ£€æŸ¥

```bash
#!/bin/bash
# éƒ¨ç½²éªŒè¯è„šæœ¬ - verify_dd_registry.sh

set -e

echo "å¼€å§‹éªŒè¯ DD Registry CW éƒ¨ç½²..."

cd /home/lc/luckee_dao/deployment
source contract_addresses.env

# æ£€æŸ¥ DD Registry CW åˆçº¦çŠ¶æ€
echo "æ£€æŸ¥ DD Registry CW åˆçº¦çŠ¶æ€..."
wasmd query wasm contract-state smart ${DD_REGISTRY_CONTRACT} '{"get_config":{}}' \
  --node ${NODE} --output json | jq '.'

echo "DD Registry CW éƒ¨ç½²éªŒè¯å®Œæˆï¼"
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦è§„åˆ™

### 1. ç³»ç»Ÿç›‘æ§æŒ‡æ ‡

#### 1.1 åˆçº¦æ€§èƒ½æŒ‡æ ‡

```yaml
contract_performance_metrics:
  dd_registry_cw:
    gas_usage:
      register_operation:
        threshold: 40000
        alert_level: "warning"
        critical_threshold: 50000
        
      allocate_rewards:
        threshold: 80000
        alert_level: "warning"
        critical_threshold: 100000
        
      withdraw_points:
        threshold: 60000
        alert_level: "warning"
        critical_threshold: 80000
    
    response_time:
      register_operation:
        threshold: "80ms"
        alert_level: "warning"
        critical_threshold: "150ms"
        
      allocate_rewards:
        threshold: "150ms"
        alert_level: "warning"
        critical_threshold: "250ms"
        
      query_operations:
        threshold: "50ms"
        alert_level: "warning"
        critical_threshold: "100ms"
```

#### 1.2 ä¸šåŠ¡æŒ‡æ ‡

```yaml
business_metrics:
  user_metrics:
    total_registered_users:
      threshold: 1000000
      alert_level: "info"
      
    daily_new_registrations:
      threshold: 1000
      alert_level: "info"
      critical_threshold: 100
      
    active_referrers:
      threshold: 10000
      alert_level: "info"
  
  referral_metrics:
    total_referral_relationships:
      threshold: 5000000
      alert_level: "info"
      
    daily_referral_activities:
      threshold: 10000
      alert_level: "info"
      critical_threshold: 1000
      
    referral_conversion_rate:
      threshold: 0.3
      alert_level: "warning"
      critical_threshold: 0.1
  
  points_metrics:
    total_points_allocated:
      threshold: 1000000000000000
      alert_level: "info"
      
    daily_points_allocation:
      threshold: 10000000000000
      alert_level: "warning"
      critical_threshold: 1000000000000
      
    average_points_per_user:
      threshold: 1000000
      alert_level: "info"
```

### 2. å‘Šè­¦è§„åˆ™é…ç½®

#### 2.1 Prometheus å‘Šè­¦è§„åˆ™

```yaml
# prometheus_alerts_dd_registry.yml
groups:
  - name: dd_registry_cw_contracts
    rules:
      # Gas ä½¿ç”¨å‘Šè­¦
      - alert: DDRegistryHighGasUsage
        expr: dd_registry_gas_usage > 100000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "DD Registry high gas usage detected"
          description: "DD Registry contract is using {{ $value }} gas"
      
      # å“åº”æ—¶é—´å‘Šè­¦
      - alert: DDRegistryHighResponseTime
        expr: dd_registry_response_time > 300
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "DD Registry high response time detected"
          description: "DD Registry response time is {{ $value }}ms"
      
      # å¾ªç¯æ¨èæ£€æµ‹å‘Šè­¦
      - alert: CircularReferralDetected
        expr: increase(circular_referral_attempts_total[5m]) > 10
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Circular referral attempts detected"
          description: "{{ $value }} circular referral attempts in 5 minutes"
      
      # ç§¯åˆ†åˆ†é…å¤±è´¥å‘Šè­¦
      - alert: PointsAllocationFailure
        expr: rate(points_allocation_failures_total[5m]) > 0.05
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High points allocation failure rate"
          description: "Points allocation failure rate is {{ $value }}"
```

## ğŸ”§ è¿ç»´æ‰‹å†Œ

### 1. æ—¥å¸¸è¿ç»´ä»»åŠ¡

#### 1.1 å¥åº·æ£€æŸ¥

```bash
#!/bin/bash
# å¥åº·æ£€æŸ¥è„šæœ¬ - health_check_dd_registry.sh

set -e

echo "å¼€å§‹ DD Registry CW å¥åº·æ£€æŸ¥..."

cd /home/lc/luckee_dao/deployment
source contract_addresses.env

# æ£€æŸ¥åˆçº¦çŠ¶æ€
check_dd_registry_health() {
  echo "æ£€æŸ¥ DD Registry CW åˆçº¦..."
  
  if wasmd query wasm contract-state smart ${DD_REGISTRY_CONTRACT} '{"get_config":{}}' \
    --node ${NODE} --output json > /dev/null 2>&1; then
    echo "âœ… DD Registry CW å¥åº·"
    return 0
  else
    echo "âŒ DD Registry CW å¼‚å¸¸"
    return 1
  fi
}

# æ£€æŸ¥åˆçº¦
check_dd_registry_health

echo "DD Registry CW å¥åº·æ£€æŸ¥å®Œæˆï¼"
```

#### 1.2 æ€§èƒ½ç›‘æ§

```bash
#!/bin/bash
# æ€§èƒ½ç›‘æ§è„šæœ¬ - performance_monitor_dd_registry.sh

set -e

echo "å¼€å§‹ DD Registry CW æ€§èƒ½ç›‘æ§..."

cd /home/lc/luckee_dao/deployment
source contract_addresses.env

# ç›‘æ§ Gas ä½¿ç”¨
monitor_dd_registry_gas() {
  local operation=$1
  
  echo "ç›‘æ§ DD Registry CW çš„ ${operation} æ“ä½œ Gas ä½¿ç”¨..."
  
  # æ‰§è¡Œæµ‹è¯•æ“ä½œå¹¶è®°å½• Gas ä½¿ç”¨
  local gas_used=$(wasmd tx wasm execute ${DD_REGISTRY_CONTRACT} '{"'${operation}'":{}}' \
    --from ${ADMIN_ADDRESS} \
    --chain-id ${CHAIN_ID} \
    --node ${NODE} \
    --gas auto \
    --gas-adjustment 1.3 \
    --yes \
    --output json | jq -r '.gas_used')
  
  echo "Gas ä½¿ç”¨: ${gas_used}"
  
  # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼
  if [ ${gas_used} -gt 100000 ]; then
    echo "âš ï¸ Gas ä½¿ç”¨è¶…è¿‡é˜ˆå€¼"
  fi
}

# ç›‘æ§å„æ“ä½œæ€§èƒ½
monitor_dd_registry_gas "get_config"

echo "DD Registry CW æ€§èƒ½ç›‘æ§å®Œæˆï¼"
```

### 2. æ•…éšœå¤„ç†

#### 2.1 ç´§æ€¥æš‚åœ

```bash
#!/bin/bash
# ç´§æ€¥æš‚åœè„šæœ¬ - emergency_pause_dd_registry.sh

set -e

echo "æ‰§è¡Œ DD Registry CW ç´§æ€¥æš‚åœ..."

cd /home/lc/luckee_dao/deployment
source contract_addresses.env

# æš‚åœ DD Registry CW åˆçº¦
echo "æš‚åœ DD Registry CW åˆçº¦..."

wasmd tx wasm execute ${DD_REGISTRY_CONTRACT} '{
  "emergency_pause": {
    "paused": true
  }
}' \
  --from ${ADMIN_ADDRESS} \
  --chain-id ${CHAIN_ID} \
  --node ${NODE} \
  --gas auto \
  --gas-adjustment 1.3 \
  --yes

echo "âœ… DD Registry CW å·²æš‚åœ"
echo "ç´§æ€¥æš‚åœå®Œæˆï¼"
```

#### 2.2 ç³»ç»Ÿæ¢å¤

```bash
#!/bin/bash
# ç³»ç»Ÿæ¢å¤è„šæœ¬ - system_recovery_dd_registry.sh

set -e

echo "å¼€å§‹ DD Registry CW ç³»ç»Ÿæ¢å¤..."

cd /home/lc/luckee_dao/deployment
source contract_addresses.env

# æ¢å¤ DD Registry CW åˆçº¦
echo "æ¢å¤ DD Registry CW åˆçº¦..."

wasmd tx wasm execute ${DD_REGISTRY_CONTRACT} '{
  "emergency_pause": {
    "paused": false
  }
}' \
  --from ${ADMIN_ADDRESS} \
  --chain-id ${CHAIN_ID} \
  --node ${NODE} \
  --gas auto \
  --gas-adjustment 1.3 \
  --yes

echo "âœ… DD Registry CW å·²æ¢å¤"
echo "ç³»ç»Ÿæ¢å¤å®Œæˆï¼"
```

### 3. å¤‡ä»½å’Œæ¢å¤

#### 3.1 æ•°æ®å¤‡ä»½

```bash
#!/bin/bash
# æ•°æ®å¤‡ä»½è„šæœ¬ - backup_dd_registry.sh

set -e

echo "å¼€å§‹ DD Registry CW æ•°æ®å¤‡ä»½..."

BACKUP_DIR="/home/lc/luckee_dao/backups/dd_registry/$(date +%Y%m%d_%H%M%S)"
mkdir -p ${BACKUP_DIR}

cd /home/lc/luckee_dao/deployment
source contract_addresses.env

# å¤‡ä»½åˆçº¦çŠ¶æ€
echo "å¤‡ä»½ DD Registry CW çŠ¶æ€..."

# å¤‡ä»½åˆçº¦é…ç½®
wasmd query wasm contract-state smart ${DD_REGISTRY_CONTRACT} '{"get_config":{}}' \
  --node ${NODE} --output json > ${BACKUP_DIR}/dd_registry_config.json

# å¤‡ä»½åˆçº¦ä»£ç 
wasmd query wasm code ${DD_REGISTRY_CONTRACT} \
  --node ${NODE} --output json > ${BACKUP_DIR}/dd_registry_code.json

# å¤‡ä»½ç”¨æˆ·æ•°æ®ï¼ˆç¤ºä¾‹ï¼‰
wasmd query wasm contract-state smart ${DD_REGISTRY_CONTRACT} '{"get_stats":{}}' \
  --node ${NODE} --output json > ${BACKUP_DIR}/dd_registry_stats.json

echo "DD Registry CW æ•°æ®å¤‡ä»½å®Œæˆï¼å¤‡ä»½ç›®å½•: ${BACKUP_DIR}"
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. Gas ä¼˜åŒ–

```yaml
gas_optimization:
  strategies:
    - "ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘äº¤æ˜“æ•°é‡"
    - "ä¼˜åŒ–å­˜å‚¨ç»“æ„å‡å°‘è¯»å†™æ¬¡æ•°"
    - "ä½¿ç”¨ç´¢å¼•æé«˜æŸ¥è¯¢æ•ˆç‡"
    - "ç¼“å­˜å¸¸ç”¨æ•°æ®é¿å…é‡å¤è®¡ç®—"
  
  implementation:
    batch_operations:
      enabled: true
      max_batch_size: 50
      
    storage_optimization:
      enabled: true
      compression: true
      
    query_optimization:
      enabled: true
      index_strategy: "btree"
```

### 2. å“åº”æ—¶é—´ä¼˜åŒ–

```yaml
response_time_optimization:
  strategies:
    - "å¼‚æ­¥å¤„ç†éå…³é”®æ“ä½œ"
    - "ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—"
    - "ä¼˜åŒ–æ¨èé“¾æŸ¥è¯¢ç®—æ³•"
    - "å¹¶è¡Œå¤„ç†ç‹¬ç«‹æ“ä½œ"
  
  implementation:
    async_processing:
      enabled: true
      queue_size: 500
      
    caching:
      enabled: true
      cache_size: "50MB"
      ttl: "300s"
      
    parallel_processing:
      enabled: true
      max_workers: 5
```

## ğŸ“ å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|----------|--------|
| v1.0 | 2024-01-XX | åˆå§‹ç‰ˆæœ¬åˆ›å»º | AI Assistant |

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ç¡®ä¿äº¤ä»˜ç‰©èƒ½è¢«æ­£ç¡®ã€é«˜æ•ˆåœ°éƒ¨ç½²å’Œè¿ç»´ã€‚æ‰€æœ‰è„šæœ¬å’Œé…ç½®éƒ½ç»è¿‡æµ‹è¯•éªŒè¯ï¼Œå¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚
