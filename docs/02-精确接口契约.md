# DD Registry CW ç²¾ç¡®æ¥å£å¥‘çº¦

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**: DD Registry CW (æ¨èç§¯åˆ†åˆçº¦)
- **ç‰ˆæœ¬**: v1.0
- **æ–‡æ¡£ç±»å‹**: ç²¾ç¡®æ¥å£å¥‘çº¦
- **æ ‡å‡†**: OpenAPI Specification 3.0
- **åˆ›å»ºæ—¥æœŸ**: 2024-01-XX
- **æœ€åæ›´æ–°**: 2024-01-XX

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†DD Registry CWåˆçº¦çš„æ‰€æœ‰æ¥å£ï¼ŒåŒ…æ‹¬è¯·æ±‚/å“åº”æ ¼å¼ã€çŠ¶æ€ç ã€é”™è¯¯ç±»å‹å’Œæ•°æ®éªŒè¯è§„åˆ™ã€‚ä½œä¸ºAIä¹‹é—´ã€ç³»ç»Ÿä¸ç³»ç»Ÿä¹‹é—´äº¤äº’çš„"æ³•å¾‹æ–‡ä¹¦"ï¼Œç¡®ä¿æ— ç¼é›†æˆã€‚

## ğŸ“¡ åˆçº¦æ¥å£è§„èŒƒ

### 1. å®ä¾‹åŒ–æ¥å£ (InstantiateMsg)

```yaml
openapi: 3.0.0
info:
  title: DD Registry CW Contract API
  version: 1.0.0
  description: DD Registry CWæ¨èç§¯åˆ†åˆçº¦æ¥å£è§„èŒƒ

paths:
  /instantiate:
    post:
      summary: å®ä¾‹åŒ–åˆçº¦
      description: åˆ›å»ºæ–°çš„DD Registry CWåˆçº¦å®ä¾‹
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstantiateMsg'
      responses:
        '200':
          description: å®ä¾‹åŒ–æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstantiateResponse'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    InstantiateMsg:
      type: object
      required:
        - admin
        - config
      properties:
        admin:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          description: ç®¡ç†å‘˜åœ°å€
          example: "luckee1abc123..."
        config:
          $ref: '#/components/schemas/ContractConfig'

    ContractConfig:
      type: object
      required:
        - enabled
        - max_referral_depth
        - referral_cooldown
        - max_daily_referrals
        - min_withdrawal_amount
        - emergency_paused
      properties:
        enabled:
          type: boolean
          description: ç³»ç»Ÿæ˜¯å¦å¯ç”¨
          example: true
        max_referral_depth:
          type: integer
          minimum: 1
          maximum: 10
          description: æœ€å¤§æ¨èæ·±åº¦
          example: 3
        referral_cooldown:
          type: integer
          minimum: 0
          description: æ¨èå†·å´æœŸï¼ˆç§’ï¼‰
          example: 3600
        max_daily_referrals:
          type: integer
          minimum: 1
          description: æ¯æ—¥æœ€å¤§æ¨èæ•°
          example: 10
        min_withdrawal_amount:
          type: string
          pattern: '^[0-9]+$'
          description: æœ€å°æå–æ•°é‡
          example: "1000"
        emergency_paused:
          type: boolean
          description: æ˜¯å¦ç´§æ€¥æš‚åœ
          example: false

    InstantiateResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        contract_address:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          example: "luckee1jkl012..."
        config:
          $ref: '#/components/schemas/ContractConfig'
```

### 2. æ‰§è¡Œæ¥å£ (ExecuteMsg)

```yaml
  /execute:
    post:
      summary: æ‰§è¡Œåˆçº¦æ“ä½œ
      description: æ‰§è¡Œæ¨èç§¯åˆ†ç›¸å…³æ“ä½œ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExecuteMsg'
      responses:
        '200':
          description: æ‰§è¡ŒæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecuteResponse'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: æƒé™ä¸è¶³
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    ExecuteMsg:
      type: object
      oneOf:
        - $ref: '#/components/schemas/RegisterMsg'
        - $ref: '#/components/schemas/AllocateRewardsMsg'
        - $ref: '#/components/schemas/WithdrawPointsMsg'
        - $ref: '#/components/schemas/AdminMsg'

    RegisterMsg:
      type: object
      required:
        - register
      properties:
        register:
          type: object
          properties:
            referrer:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: æ¨èäººåœ°å€ï¼ˆå¯é€‰ï¼‰
              nullable: true

    AllocateRewardsMsg:
      type: object
      required:
        - allocate_rewards
      properties:
        allocate_rewards:
          type: object
          required:
            - user
            - points
            - reason
          properties:
            user:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: ç”¨æˆ·åœ°å€
            points:
              type: string
              pattern: '^[0-9]+$'
              minimum: "1"
              description: ç§¯åˆ†æ•°é‡
            reason:
              type: string
              enum: ["activity_bonus", "referral_reward", "level_bonus", "special_event"]
              description: ç§¯åˆ†åŸå› 
            related_user:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: ç›¸å…³ç”¨æˆ·åœ°å€ï¼ˆå¯é€‰ï¼‰
              nullable: true
            event_id:
              type: string
              description: äº‹ä»¶IDï¼ˆå¯é€‰ï¼‰
              nullable: true

    WithdrawPointsMsg:
      type: object
      required:
        - withdraw_points
      properties:
        withdraw_points:
          type: object
          required:
            - amount
          properties:
            amount:
              type: string
              pattern: '^[0-9]+$'
              minimum: "1000"
              description: æå–çš„ç§¯åˆ†æ•°é‡

    AdminMsg:
      type: object
      oneOf:
        - $ref: '#/components/schemas/UpdateConfigMsg'
        - $ref: '#/components/schemas/EmergencyPauseMsg'

    UpdateConfigMsg:
      type: object
      required:
        - update_config
      properties:
        update_config:
          type: object
          required:
            - config
          properties:
            config:
              $ref: '#/components/schemas/ContractConfig'

    EmergencyPauseMsg:
      type: object
      required:
        - emergency_pause
      properties:
        emergency_pause:
          type: object
          required:
            - paused
          properties:
            paused:
              type: boolean
              description: æ˜¯å¦æš‚åœ

    ExecuteResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        transaction_hash:
          type: string
          description: äº¤æ˜“å“ˆå¸Œ
          example: "0x1234567890abcdef..."
        events:
          type: array
          items:
            $ref: '#/components/schemas/Event'
          description: äº‹ä»¶åˆ—è¡¨
```

### 3. æŸ¥è¯¢æ¥å£ (QueryMsg)

```yaml
  /query:
    post:
      summary: æŸ¥è¯¢åˆçº¦çŠ¶æ€
      description: æŸ¥è¯¢æ¨èç§¯åˆ†ç›¸å…³ä¿¡æ¯
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryMsg'
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/UserInfoResponse'
                  - $ref: '#/components/schemas/ReferralChainResponse'
                  - $ref: '#/components/schemas/PointsLeaderboardResponse'
                  - $ref: '#/components/schemas/ConfigResponse'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    QueryMsg:
      type: object
      oneOf:
        - $ref: '#/components/schemas/UserInfoQuery'
        - $ref: '#/components/schemas/ReferralChainQuery'
        - $ref: '#/components/schemas/PointsLeaderboardQuery'
        - $ref: '#/components/schemas/ConfigQuery'

    UserInfoQuery:
      type: object
      required:
        - get_user_info
      properties:
        get_user_info:
          type: object
          required:
            - user
          properties:
            user:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: ç”¨æˆ·åœ°å€

    ReferralChainQuery:
      type: object
      required:
        - get_referral_chain
      properties:
        get_referral_chain:
          type: object
          required:
            - user
          properties:
            user:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: ç”¨æˆ·åœ°å€
            max_depth:
              type: integer
              minimum: 1
              maximum: 3
              description: æœ€å¤§æŸ¥è¯¢æ·±åº¦
              default: 3

    PointsLeaderboardQuery:
      type: object
      required:
        - get_points_leaderboard
      properties:
        get_points_leaderboard:
          type: object
          properties:
            limit:
              type: integer
              minimum: 1
              maximum: 100
              description: è¿”å›æ•°é‡é™åˆ¶
              default: 10
            offset:
              type: integer
              minimum: 0
              description: åç§»é‡
              default: 0

    ConfigQuery:
      type: object
      required:
        - get_config
      properties:
        get_config:
          type: object
          description: æŸ¥è¯¢åˆçº¦é…ç½®

    UserInfoResponse:
      type: object
      properties:
        user_info:
          type: object
          properties:
            recommender:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: æ¨èäººåœ°å€
              nullable: true
            direct_referrals:
              type: array
              items:
                type: string
                pattern: '^luckee[a-z0-9]{38}$'
              description: ç›´æ¥æ¨èçš„ä¸‹çº§
            reward_points:
              type: string
              pattern: '^[0-9]+$'
              description: ç´¯ç§¯ç§¯åˆ†
            registered_at:
              type: integer
              description: æ³¨å†Œæ—¶é—´æˆ³
            last_active_at:
              type: integer
              description: æœ€åæ´»è·ƒæ—¶é—´æˆ³
            user_level:
              type: string
              enum: ["Bronze", "Silver", "Gold", "Platinum"]
              description: ç”¨æˆ·ç­‰çº§
            referral_stats:
              type: object
              properties:
                total_referrals:
                  type: integer
                  description: æ€»æ¨èæ•°
                active_referrals:
                  type: integer
                  description: æ´»è·ƒæ¨èæ•°
                total_points_earned:
                  type: string
                  pattern: '^[0-9]+$'
                  description: æ€»è·å¾—ç§¯åˆ†
            status:
              type: string
              enum: ["active", "suspended", "banned"]
              description: ç”¨æˆ·çŠ¶æ€

    ReferralChainResponse:
      type: object
      properties:
        referral_chain:
          type: array
          items:
            type: object
            properties:
              user:
                type: string
                pattern: '^luckee[a-z0-9]{38}$'
                description: ç”¨æˆ·åœ°å€
              level:
                type: integer
                minimum: 1
                maximum: 3
                description: æ¨èå±‚çº§
              points:
                type: string
                pattern: '^[0-9]+$'
                description: ç§¯åˆ†æ•°é‡
              user_level:
                type: string
                enum: ["Bronze", "Silver", "Gold", "Platinum"]
                description: ç”¨æˆ·ç­‰çº§
              referral_count:
                type: integer
                description: æ¨èæ•°é‡
        total_depth:
          type: integer
          description: æ€»æ·±åº¦
        total_nodes:
          type: integer
          description: æ€»èŠ‚ç‚¹æ•°

    PointsLeaderboardResponse:
      type: object
      properties:
        leaderboard:
          type: array
          items:
            type: object
            properties:
              rank:
                type: integer
                description: æ’å
              user:
                type: string
                pattern: '^luckee[a-z0-9]{38}$'
                description: ç”¨æˆ·åœ°å€
              points:
                type: string
                pattern: '^[0-9]+$'
                description: ç§¯åˆ†æ•°é‡
              user_level:
                type: string
                enum: ["Bronze", "Silver", "Gold", "Platinum"]
                description: ç”¨æˆ·ç­‰çº§
              referral_count:
                type: integer
                description: æ¨èæ•°é‡
        total_users:
          type: integer
          description: æ€»ç”¨æˆ·æ•°
        user_rank:
          type: integer
          description: æŸ¥è¯¢ç”¨æˆ·çš„æ’å
          nullable: true

    ConfigResponse:
      type: object
      properties:
        config:
          $ref: '#/components/schemas/ContractConfig'
        admin:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          description: ç®¡ç†å‘˜åœ°å€
```

### 4. é”™è¯¯å“åº”è§„èŒƒ

```yaml
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              description: é”™è¯¯ä»£ç 
              example: "USER_ALREADY_EXISTS"
            message:
              type: string
              description: é”™è¯¯æ¶ˆæ¯
              example: "ç”¨æˆ·å·²å­˜åœ¨"
            details:
              type: object
              description: é”™è¯¯è¯¦æƒ…
              properties:
                field:
                  type: string
                  description: é”™è¯¯å­—æ®µ
                  example: "user"
                value:
                  type: string
                  description: é”™è¯¯å€¼
                  example: "luckee1invalid..."
                suggestion:
                  type: string
                  description: ä¿®å¤å»ºè®®
                  example: "ä½¿ç”¨æœ‰æ•ˆçš„ç”¨æˆ·åœ°å€"

    ErrorCodes:
      type: object
      properties:
        USER_ALREADY_EXISTS:
          type: object
          properties:
            code: "USER_ALREADY_EXISTS"
            message: "ç”¨æˆ·å·²å­˜åœ¨"
            http_status: 400
        INVALID_REFERRER:
          type: object
          properties:
            code: "INVALID_REFERRER"
            message: "æ— æ•ˆçš„æ¨èäººåœ°å€"
            http_status: 400
        CIRCULAR_REFERRAL:
          type: object
          properties:
            code: "CIRCULAR_REFERRAL"
            message: "æ£€æµ‹åˆ°å¾ªç¯æ¨è"
            http_status: 400
        UNAUTHORIZED:
          type: object
          properties:
            code: "UNAUTHORIZED"
            message: "è°ƒç”¨è€…æ— æƒé™æ‰§è¡Œæ­¤æ“ä½œ"
            http_status: 401
        USER_NOT_FOUND:
          type: object
          properties:
            code: "USER_NOT_FOUND"
            message: "ç”¨æˆ·ä¸å­˜åœ¨"
            http_status: 404
        INSUFFICIENT_POINTS:
          type: object
          properties:
            code: "INSUFFICIENT_POINTS"
            message: "ç§¯åˆ†ä¸è¶³"
            http_status: 400
        SYSTEM_PAUSED:
          type: object
          properties:
            code: "SYSTEM_PAUSED"
            message: "ç³»ç»Ÿå·²æš‚åœ"
            http_status: 503
```

## ğŸ”’ æ•°æ®éªŒè¯è§„åˆ™

### 1. åœ°å€éªŒè¯

```yaml
address_validation:
  pattern: '^luckee[a-z0-9]{38}$'
  description: "Luckeeåœ°å€æ ¼å¼éªŒè¯"
  examples:
    valid: "luckee1abc123def456ghi789jkl012mno345pqr678stu901vwx234"
    invalid: "cosmos1abc123..." # é”™è¯¯çš„åœ°å€å‰ç¼€
    invalid: "luckee1abc" # åœ°å€é•¿åº¦ä¸è¶³
```

### 2. ç§¯åˆ†æ•°é‡éªŒè¯

```yaml
points_validation:
  pattern: '^[0-9]+$'
  minimum: "1"
  maximum: "1000000000000000000"
  description: "ç§¯åˆ†æ•°é‡éªŒè¯"
  examples:
    valid: "1000000" # 100ä¸‡ç§¯åˆ†
    valid: "1" # æœ€å°å•ä½
    invalid: "0" # ä¸èƒ½ä¸º0
    invalid: "1000000000000000001" # è¶…è¿‡æœ€å¤§å€¼
    invalid: "1.5" # ä¸èƒ½æœ‰å°æ•°
    invalid: "-1000000" # ä¸èƒ½ä¸ºè´Ÿæ•°
```

### 3. ç”¨æˆ·ç­‰çº§éªŒè¯

```yaml
user_level_validation:
  enum: ["Bronze", "Silver", "Gold", "Platinum"]
  description: "ç”¨æˆ·ç­‰çº§éªŒè¯"
  examples:
    valid: "Bronze"
    valid: "Platinum"
    invalid: "Diamond" # ä¸å­˜åœ¨çš„ç­‰çº§
    invalid: "bronze" # å¤§å°å†™æ•æ„Ÿ
```

## ğŸ“Š çŠ¶æ€ç æ˜ å°„

```yaml
status_code_mapping:
  success:
    http_status: 200
    cosmwasm_status: "success"
    description: "æ“ä½œæˆåŠŸ"
  
  bad_request:
    http_status: 400
    cosmwasm_status: "failure"
    description: "è¯·æ±‚å‚æ•°é”™è¯¯"
    error_codes:
      - "USER_ALREADY_EXISTS"
      - "INVALID_REFERRER"
      - "CIRCULAR_REFERRAL"
      - "INSUFFICIENT_POINTS"
      - "INVALID_POINTS"
  
  unauthorized:
    http_status: 401
    cosmwasm_status: "failure"
    description: "æƒé™ä¸è¶³"
    error_codes:
      - "UNAUTHORIZED"
  
  not_found:
    http_status: 404
    cosmwasm_status: "failure"
    description: "èµ„æºä¸å­˜åœ¨"
    error_codes:
      - "USER_NOT_FOUND"
  
  service_unavailable:
    http_status: 503
    cosmwasm_status: "failure"
    description: "æœåŠ¡ä¸å¯ç”¨"
    error_codes:
      - "SYSTEM_PAUSED"
```

## ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§

```yaml
version_compatibility:
  current_version: "1.0.0"
  supported_versions:
    - "1.0.0"
  
  breaking_changes:
    v1.0.0:
      - "åˆå§‹ç‰ˆæœ¬å‘å¸ƒ"
      - "åŸºç¡€æ¨èç§¯åˆ†åŠŸèƒ½"
      - "ç”¨æˆ·ç­‰çº§ç³»ç»Ÿ"
  
  migration_guide:
    initial_deployment:
      - "é¦–æ¬¡éƒ¨ç½²æ— éœ€è¿ç§»"
      - "é…ç½®æ¨èè§„åˆ™"
      - "è®¾ç½®æƒé™æ§åˆ¶"
```

## ğŸ“ å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|----------|--------|
| v1.0 | 2024-01-XX | åˆå§‹æ¥å£è§„èŒƒåˆ›å»º | AI Assistant |

---

**æ³¨æ„**: æœ¬æ–‡æ¡£æ˜¯AIä¹‹é—´ã€ç³»ç»Ÿä¸ç³»ç»Ÿä¹‹é—´äº¤äº’çš„"æ³•å¾‹æ–‡ä¹¦"ï¼Œä»»ä½•æ¥å£å˜æ›´éƒ½å¿…é¡»åŒæ­¥æ›´æ–°æœ¬æ–‡æ¡£ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰ç›¸å…³æ–¹ã€‚